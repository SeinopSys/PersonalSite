"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],i=!0,s=!1,l=void 0;try{for(var n,r=e[Symbol.iterator]();!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){s=!0,l=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw l}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _classPrivateFieldGet(e,t){return _classApplyDescriptorGet(e,_classExtractFieldDescriptor(e,t,"get"))}function _classApplyDescriptorGet(e,t){return t.get?t.get.call(e):t.value}function _classPrivateMethodGet(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}function _classPrivateFieldSet(e,t,a){return _classApplyDescriptorSet(e,_classExtractFieldDescriptor(e,t,"set"),a),a}function _classExtractFieldDescriptor(e,t,a){if(!t.has(e))throw new TypeError("attempted to "+a+" private field on non-instance");return t.get(e)}function _classApplyDescriptorSet(e,t,a){if(t.set)t.set.call(e,a);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=a}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){window.URL||(window.URL=window.webkitURL);var a={player:t,editor:t};function i(t){return 100*e.roundTo(t,5)+"%"}var s=function e(){var a=arguments.length>0&&arguments[0]!==t?arguments[0]:"",i=arguments.length>1&&arguments[1]!==t?arguments[1]:t,s=arguments.length>2&&arguments[2]!==t?arguments[2]:null;_classCallCheck(this,e),this.str=a.trim(),this.ts=i instanceof r?i:new r(i),this.$domNode=s},l=new WeakMap,n=new WeakSet,r=function(){function a(e){var i=arguments.length>1&&arguments[1]!==t&&arguments[1];switch(_classCallCheck(this,a),n.add(this),l.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,l,i),_typeof(e)){case"string":_classPrivateMethodGet(this,n,o).call(this,e);break;case"number":this.seconds=parseFloat(parseFloat(e).toFixed(2)),_classPrivateFieldGet(this,l)&&(this.seconds=Math.ceil(this.seconds))}}return _createClass(a,[{key:"toString",value:function(){var a=arguments.length>0&&arguments[0]!==t&&arguments[0];if(void 0===this.seconds)return"";var i=this.seconds,s=Math.floor(i/60);s>0&&(i-=60*s);var n=a?e.pad(s):String(s),r=i.toFixed(2).split("."),o=_slicedToArray(r,2),c=o[0],d=o[1];return"".concat(n,":").concat(e.pad(c)).concat(_classPrivateFieldGet(this,l)?"":".".concat(d))}}],[{key:"isValid",value:function(e){return/(?:\d+:)?[0-5]?\d:[0-5]\d(?:\.\d{1,2})?/.test(e)}}]),a}();function o(e){if(r.isValid(e)){var t=e.split(":"),a=parseFloat(t.pop());t.length&&(a+=60*parseInt(t.pop(),10)),this.seconds=a}else this.seconds=NaN}var c=new WeakMap,d=new WeakMap,u=new WeakMap,v=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,y=new WeakMap,g=new WeakMap,_=function(){function a(e){_classCallCheck(this,a),c.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:void 0}),u.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,c,e),_classPrivateFieldSet(this,d,_classPrivateFieldGet(this,c).find(".status-position")),_classPrivateFieldSet(this,u,_classPrivateFieldGet(this,c).find(".status-duration")),_classPrivateFieldSet(this,v,_classPrivateFieldGet(this,c).find(".status-filename")),_classPrivateFieldSet(this,h,_classPrivateFieldGet(this,c).find(".status-filetype")),this.$progressWrap=_classPrivateFieldGet(this,c).find(".progress-wrap"),_classPrivateFieldSet(this,p,_classPrivateFieldGet(this,c).find(".progress-indicator .fill")),_classPrivateFieldSet(this,f,_classPrivateFieldGet(this,c).find(".progress-indicator .loaded")),_classPrivateFieldSet(this,y,_classPrivateFieldGet(this,c).find(".progress-indicator .entry-sticks")),_classPrivateFieldSet(this,g,_classPrivateFieldGet(this,c).find(".thumb")),this.setFileName(),this.setProgress(),this.showThumb()}return _createClass(a,[{key:"setFileName",value:function(e,t){_classPrivateFieldGet(this,v).text(e?e.replace(/\.[^.]+$/,""):""),_classPrivateFieldGet(this,h).text(t?t.split("/")[1].toUpperCase():"")}},{key:"getFileName",value:function(){return _classPrivateFieldGet(this,v).text().trim()}},{key:"setProgress",value:function(e,a){if(e===t&&a===t)return _classPrivateFieldGet(this,d).html("&hellip;"),void _classPrivateFieldGet(this,u).html("&hellip;");var i=e||0,s=a||0;_classPrivateFieldGet(this,d).text(new r(i)),_classPrivateFieldGet(this,u).text(new r(s)),this.updateSeek(i,s)}},{key:"setLoaded",value:function(t,a){_classPrivateFieldGet(this,f).empty();for(var s=0;s<t.length;s++){var l=t.start(s),n=t.end(s);_classPrivateFieldGet(this,f).append(e.mk("div").css({left:i(l/a),width:i((n-l)/a)}))}}},{key:"setEntries",value:function(t,a){var s=this;_classPrivateFieldGet(this,y).empty(),e.each(t,(function(t,l){_classPrivateFieldGet(s,y).append(e.mk("div").css({left:i(l.ts.seconds/a)}))}))}},{key:"updateSeek",value:function(e,t){var a=i(e/t);_classPrivateFieldGet(this,p).css("width",a),_classPrivateFieldGet(this,g).css("left",a)}},{key:"showThumb",value:function(e){_classPrivateFieldGet(this,c)[e?"addClass":"removeClass"]("playing")}}]),a}(),m=new WeakMap,P=new WeakMap,F=new WeakMap,k=new WeakMap,b=new WeakMap,w=new WeakMap,G=new WeakMap,S=new WeakMap,C=new WeakMap,M=new WeakSet,T=new WeakSet,I=function(){function i(){var a=this;_classCallCheck(this,i),T.add(this),M.add(this),m.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,m,e("#player")),_classPrivateFieldSet(this,P,e.mk("input","audiofilein").attr({type:"file",accept:"audio/*",tabindex:-1,class:"fileinput"}).appendTo($body)),_classPrivateFieldSet(this,F,e("#audiofilebtn")),this.$playbackbtn=e("#playbackbtn"),_classPrivateFieldSet(this,k,new Audio),_classPrivateFieldGet(this,k).preload="auto",this.$stopbtn=e("#stopbtn"),e(_classPrivateFieldGet(this,k)).on("ended",(function(){a.stop(),a.updatePlaybackButtons()})).on("loadeddata",(function(){_classPrivateFieldGet(a,C).setProgress(),a.updateInd(),_classPrivateFieldGet(a,F).enable(),a.updatePlaybackButtons(),_classPrivateFieldGet(a,C).showThumb(!0),a.updateEntrySticks(),a.setMetadataLength()})),_classPrivateFieldSet(this,b,{}),_classPrivateFieldSet(this,w,.05),_classPrivateFieldSet(this,G,e("#volumedisp")),this.$volumedown=e("#volumedown"),this.$volumeup=e("#volumeup");var s,l=i.getSessionVolume();this.volume(l),this.updateVolumeButtons(l),_classPrivateFieldSet(this,S,t),_classPrivateFieldSet(this,C,new _(_classPrivateFieldGet(this,m).find(".state"))),_classPrivateFieldGet(this,C).$progressWrap.on("mousedown",(function(e){1===e.which&&a.hasFile()&&(e.preventDefault(),_classPrivateFieldGet(a,C).$progressWrap.addClass("moving"),s=!_classPrivateFieldGet(a,k).paused,a.pause(),a.updatePlaybackButtons())})),$d.on("mouseup",(function(e){1===e.which&&_classPrivateFieldGet(a,C).$progressWrap.hasClass("moving")&&a.hasFile()&&(a.recalcThumbPos(e),_classPrivateFieldGet(a,C).$progressWrap.removeClass("moving"),s&&(a.play(),a.updatePlaybackButtons()))})),$d.on("mousemove",e.throttle(100,(function(e){_classPrivateFieldGet(a,C).$progressWrap.hasClass("moving")&&a.hasFile()&&a.recalcThumbPos(e)}))),this.$stopbtn.on("click",(function(e){e.preventDefault(),a.hasFile()&&(a.stop(),a.updatePlaybackButtons())})),this.$playbackbtn.on("click",(function(e){e.preventDefault(),a.hasFile()&&(_classPrivateFieldGet(a,k).paused?a.play():a.pause(),a.updatePlaybackButtons())})),this.$volumedown.on("click",(function(e,t,i){e.preventDefault();var s=a.volume()-(e.altKey||i?.01:_classPrivateFieldGet(a,w)*(e.shiftKey||t?2:1));a.updateVolumeButtons(s),a.volume(s)})),this.$volumeup.on("click",(function(e,t,i){e.preventDefault();var s=a.volume()+(e.altKey||i?.01:_classPrivateFieldGet(a,w)*(e.shiftKey||t?2:1));a.updateVolumeButtons(s),a.volume(s)})),_classPrivateFieldGet(this,F).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,P).trigger("click")})),_classPrivateFieldGet(this,P).on("change",(function(){_classPrivateFieldGet(a,P).val()&&(a.clearFile(),_classPrivateFieldGet(a,F).disable(),a.setFile(_classPrivateFieldGet(a,P)[0].files[0],(function(e){_classPrivateFieldGet(a,C).setFileName(e.name,e.type)})))}))}return _createClass(i,[{key:"volume",value:function(t){if(void 0===t)return _classPrivateFieldGet(this,k).volume;t=e.rangeLimit(e.roundTo(t,2),!1,0,1),_classPrivateFieldGet(this,G).text(e.pad(Math.round(100*t)," ",3)+"%"),window.localStorage&&localStorage.setItem("lrc-vol",t),_classPrivateFieldGet(this,k).volume=t}},{key:"updateVolumeButtons",value:function(e){this.$volumeup.attr("disabled",e>=1),this.$volumedown.attr("disabled",e<=0)}},{key:"updatePlaybackButtons",value:function(){var e=!this.hasFile();this.$playbackbtn.attr("disabled",e),this.$stopbtn.attr("disabled",e),ae.getInstance().disableModeButton(e),this.$playbackbtn.removeClass("btn-success btn-danger").children().removeClass("fa-play fa-pause"),_classPrivateFieldGet(this,k).paused?this.$playbackbtn.addClass("btn-success").children().addClass("fa-play"):this.$playbackbtn.addClass("btn-danger").children().addClass("fa-pause")}},{key:"play",value:function(){_classPrivateFieldGet(this,k).paused&&(_classPrivateFieldGet(this,k).play(),_classPrivateMethodGet(this,M,x).call(this),_classPrivateFieldGet(this,C).showThumb(!0))}},{key:"pause",value:function(){var e=arguments.length>0&&arguments[0]!==t&&arguments[0];_classPrivateMethodGet(this,T,D).call(this),_classPrivateFieldGet(this,k).paused||(_classPrivateFieldGet(this,k).pause(),e||this.updateInd())}},{key:"stop",value:function(){this.pause(!0),_classPrivateFieldGet(this,k).currentTime=0,this.updateInd()}},{key:"seek",value:function(t){this.hasFile()&&(_classPrivateFieldGet(this,k).currentTime=e.rangeLimit(_classPrivateFieldGet(this,k).currentTime+t,!1,0,_classPrivateFieldGet(this,k).duration),this.updateInd())}},{key:"setFile",value:function(t,a){var i=this;this.stop(),_classPrivateFieldGet(this,C).showThumb(!1),this.updatePlaybackButtons(),/^audio\//.test(t.type)?(_classPrivateFieldGet(this,k).src=URL.createObjectURL(t),new jsmediatags.Reader(t).setTagsToRead(["title","artist","album"]).read({onSuccess:function(e){"object"===_typeof(e)&&i.setMediaTags(e.tags)},onError:function(e){console.log("Failed to read ID3 tags",e.type,e.info)}}),a(t)):e.Dialog.fail(Laravel.jsLocales.dialog_format_error,Laravel.jsLocales.dialog_format_notaudio)}},{key:"hasFile",value:function(){return 0!==_classPrivateFieldGet(this,k).readyState}},{key:"clearFile",value:function(){this.stop(),_classPrivateFieldGet(this,k).src&&URL.revokeObjectURL(_classPrivateFieldGet(this,k).src),_classPrivateFieldGet(this,k).src="",this.clearMediaTags()}},{key:"getFileName",value:function(){var e=_classPrivateFieldGet(this,b);return e.title?e.artist?"".concat(e.artist," - ").concat(e.title):e.title:_classPrivateFieldGet(this,C).getFileName()}},{key:"clearMediaTags",value:function(){_classPrivateFieldSet(this,b,{}),ae.getInstance().setInitialMetadata({length:null})}},{key:"setMediaTags",value:function(e){if("object"!==_typeof(e))throw new Error("setMediaTags: tags must be an object, ".concat(_typeof(e)," given."));_classPrivateFieldSet(this,b,e),ae.getInstance().setInitialMetadata(_classPrivateFieldGet(this,b))}},{key:"getMediaTags",value:function(){return _classPrivateFieldGet(this,b)}},{key:"updateInd",value:function(){_classPrivateFieldGet(this,C).setProgress(_classPrivateFieldGet(this,k).currentTime,_classPrivateFieldGet(this,k).duration),_classPrivateFieldGet(this,C).setLoaded(_classPrivateFieldGet(this,k).buffered,_classPrivateFieldGet(this,k).duration),ae.getInstance().hlEntry(this.getPlaybackPosition())}},{key:"updateEntrySticks",value:function(){this.hasFile()&&_classPrivateFieldGet(this,C).setEntries(ae.getInstance().getTimings(),_classPrivateFieldGet(this,k).duration)}},{key:"setMetadataLength",value:function(){ae.getInstance().setInitialMetadata({length:new r(_classPrivateFieldGet(this,k).duration,!0)})}},{key:"getPlaybackPosition",value:function(){if(this.hasFile())return new r(_classPrivateFieldGet(this,k).currentTime)}},{key:"setPlaybackPosition",value:function(e){this.hasFile()&&r.isValid(e)&&(_classPrivateFieldGet(this,k).currentTime=new r(e).seconds,this.updateInd())}},{key:"recalcThumbPos",value:function(t){var a=_classPrivateFieldGet(this,C).$progressWrap.offset(),i=parseInt(_classPrivateFieldGet(this,C).$progressWrap.css("width"),10),s=e.rangeLimit(t.clientX-a.left,!1,0,i-1e-5);_classPrivateFieldGet(this,k).currentTime=_classPrivateFieldGet(this,k).duration*(s/i),_classPrivateFieldGet(this,C).updateSeek(s,i),this.updateInd()}}],[{key:"getInstance",value:function(){return void 0===a.player&&(a.player=new i),a.player}},{key:"getSessionVolume",value:function(){if(!window.localStorage)return.5;var e=localStorage.getItem("lrc-vol");return e&&!isNaN(e)||(e="0.5",localStorage.setItem("lrc-vol",e)),parseFloat(e)}}]),i}();function x(){var e=this;_classPrivateMethodGet(this,T,D).call(this),_classPrivateFieldSet(this,S,setInterval((function(){e.updateInd()}),85))}function D(){void 0!==_classPrivateFieldGet(this,S)&&(clearInterval(_classPrivateFieldGet(this,S)),_classPrivateFieldSet(this,S,t))}var E={ar:"artist",ti:"title",al:"album",au:"lyrics_author",length:"length",by:"file_author",offset:"offset",re:"created_with",ve:"version"},L=/\[([\d:.]+)]/g,W=new RegExp("^\\[(".concat(Object.keys(E).join("|"),"):([^\\]]+)]$")),A=function t(a){var i=this;if(_classCallCheck(this,t),this.timings=[],this.metadata={},0===a.trim().length)throw new Error(Laravel.jsLocales.dialog_parse_error_empty);var l=a.trim().split("\n");e.each(l,(function(t,a){var l=a.match(L);if(l){var n=a.replace(L,"");e.each(l,(function(e,t){i.timings.push(new s(n,t.substring(1,t.length-2)))}))}else{var r=a.trim(),o=r.match(W);console.log(r),o&&(i.metadata[o[1]]=o[2])}})),this.timings.sort((function(e,t){return e.ts.seconds-t.ts.seconds}))},$=new WeakMap,j=function(){function t(a){var i=this;_classCallCheck(this,t),$.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,$,e.mk("form","metadata-editing-form")),e.each(E,(function(t,s){var l="meta_input_".concat(t),n={type:"text",name:t,id:l,value:a[t],class:"form-control"};"offset"===t&&(n.type="number",n.step="0.001",n.min="0",n.placeholder="0",n.value===n.placeholder&&(n.value="")),_classPrivateFieldGet(i,$).append(e.mk("div").attr("class","form-group").append(e.mk("label").attr({for:l}).append(Laravel.jsLocales.metadata_field_placeholders[s]," <code>".concat(t,"</code>")),e.mk("input").attr(n)))})),_classPrivateFieldGet(this,$).prepend(e.mk("div").attr("class"," alert alert-info text-center").append(e.mk("span").text(Laravel.jsLocales.dialog_edit_meta_reset_info),mk("br"),e.mk("button").attr({class:"btn btn-info",type:"reset"}).text(Laravel.jsLocales.dialog_edit_meta_reset_btn).prepend('<i class="fa fa-undo"/>')))}return _createClass(t,[{key:"get",value:function(){return _classPrivateFieldGet(this,$).clone()}}]),t}(),H=new WeakMap,B=new WeakMap,K=new WeakMap,R=new WeakMap,V=new WeakMap,N=new WeakMap,U=new WeakMap,O=new WeakMap,q=new WeakMap,Q=new WeakMap,X=new WeakMap,z=new WeakMap,J=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakSet,te=new WeakSet,ae=function(){function i(){var a=this;_classCallCheck(this,i),te.add(this),ee.add(this),H.set(this,{writable:!0,value:void 0}),B.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:void 0}),V.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),Q.set(this,{writable:!0,value:void 0}),X.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),J.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,B,e("#timings")),_classPrivateFieldSet(this,K,e("#lrcmodebtn")),_classPrivateFieldSet(this,R,e("#lrcfilebtn")),_classPrivateFieldSet(this,V,e.mk("input","lrcfilein").attr({type:"file",accept:".lrc",tabindex:-1,class:"fileinput"}).appendTo($body)),_classPrivateFieldSet(this,N,e("#lrcpastebtn")),_classPrivateFieldSet(this,U,e("#lrcexportbtn")),_classPrivateFieldSet(this,O,e("#lrcexportnometabtn")),_classPrivateFieldSet(this,q,e("#lrcmergetogglebtn")),_classPrivateFieldSet(this,Q,e("#lrcclrbtn")),_classPrivateFieldSet(this,X,e("#lrcmetadatabtn")),_classPrivateFieldSet(this,z,_classPrivateFieldGet(this,B).find(".editor")),_classPrivateFieldSet(this,J,e("#editor-entry-template").children()),this.changeMode("edit"),this.timings=[],this.initialMetadata={offset:"0",re:"".concat(window.location.href," - SeinopSys' LRC Editor"),ve:window.Laravel.git.commit_id},this.metadata={},_classPrivateFieldGet(this,z).append(this.makeEntryDiv(new s)),_classPrivateFieldSet(this,Y,t),_classPrivateFieldSet(this,H,i.getMergedOutputStrategyDefault()),_classPrivateMethodGet(this,te,se).call(this),_classPrivateFieldGet(this,K).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,K).is("[disabled]")||a.changeMode(null,e.altKey)})),_classPrivateFieldGet(this,N).on("click",(function(i){i.preventDefault();var l=e.mk("form","rawlyrics").append('<div class="form-group">\n\t\t\t\t\t\t<textarea class="form-control" rows="10"></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="text-info"><span class="fa fa-info-circle"></span> '.concat(Laravel.jsLocales.dialog_pasteraw_info,"</p>"));e.Dialog.request(Laravel.jsLocales.dialog_pasteraw_title,l,Laravel.jsLocales.dialog_pasteraw_action,(function(i){i.on("submit",(function(l){l.preventDefault(),e.Dialog.wait(!1,"Importing");var n=i.find("textarea").val().trim().split(/\n+/g);n.push(""),a.timings=n.map((function(e){return new s(e)})),I.getInstance().updateEntrySticks(),a.regenEntries(),_classPrivateFieldSet(a,Y,t),e.Dialog.close()}))}))})),_classPrivateFieldGet(this,U).on("click",(function(e){e.preventDefault(),a.storeTimings(),a.exportLRCFile()})),_classPrivateFieldGet(this,O).on("click",(function(e){e.preventDefault(),a.storeTimings(),a.exportLRCFile(!1)})),_classPrivateFieldGet(this,q).on("click",(function(e){e.preventDefault(),_classPrivateMethodGet(a,ee,ie).call(a)})),_classPrivateFieldGet(this,Q).on("click",(function(i){i.preventDefault(),e.Dialog.confirm(e(i.target).text(),t,(function(t){t&&(_classPrivateFieldGet(a,z).empty(),_classPrivateFieldGet(a,z).append(a.makeEntryDiv(new s)),a.storeTimings(),e.Dialog.close())}))})),_classPrivateFieldGet(this,X).on("click",(function(t){t.preventDefault();var i=new j(a.getCurrentMetadata()).get();e.Dialog.request(Laravel.jsLocales.dialog_edit_meta,i,Laravel.jsLocales.save,(function(){i.on("submit",(function(t){t.preventDefault();var s=i.mkData();e.each(E,(function(e){a.metadata[e]=s[e].trim()})),e.Dialog.close()})),i.on("reset",(function(t){t.preventDefault(),a.metadata={};var s=a.getCurrentMetadata();e.each(E,(function(e){i.find("input[name=".concat(e,"]")).val(s[e])}))}))}))})),_classPrivateFieldGet(this,z).on("mouseenter",(function(){_classPrivateFieldGet(a,z).stop()})),_classPrivateFieldGet(this,z).on("keyup",".timestamp",(function(t){if("edit"===_classPrivateFieldGet(a,Z)){var i=e(t.target),s=i.text().trim(),l=!r.isValid(s);i[s.length&&l?"addClass":"removeClass"]("invalid"),i.siblings(".tools").children(".goto").attr("disabled",l),I.getInstance().updateEntrySticks()}})),_classPrivateFieldGet(this,z).on("click",".addrow-up, .addrow-down",(function(t){t.preventDefault();var i="up"===e(t.target).closest("button").attr("class").match(/addrow-(up|down)/)[1]?"insertBefore":"insertAfter",l=a.makeEntryDiv(new s)[i](e(t.target).closest(".time-entry"));a.updateEntryActionButtons(),a.storeTimings(),l.addClass("new"),a.scrollHighlightedIntoView(l,!1)})),_classPrivateFieldGet(this,z).on("click",".remrow",(function(t){t.preventDefault();var i=e(t.target).closest(".time-entry");0!==i.siblings().length&&(i.remove(),a.updateEntryActionButtons(),a.storeTimings(),a.hlEntry(I.getInstance().getPlaybackPosition()))})),_classPrivateFieldGet(this,z).on("click",".goto",(function(t){t.preventDefault();var i=e(t.target).closest(".goto");if(!i.is(":disabled")){var s=i.parents(".time-entry"),l=s.find(".timestamp").text();I.getInstance().setPlaybackPosition(l),"sync"===_classPrivateFieldGet(a,Z)&&a.passSyncHandle(s)}})),_classPrivateFieldGet(this,R).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,V).trigger("click")})),_classPrivateFieldGet(this,V).on("change",(function(){_classPrivateFieldGet(a,V).val()&&(_classPrivateFieldGet(a,R).disable(),a.readLRCFile(_classPrivateFieldGet(a,V)[0].files[0],(function(e){e?a.regenEntries():_classPrivateFieldGet(a,V).val(""),_classPrivateFieldGet(a,R).enable()})))}))}return _createClass(i,[{key:"disableModeButton",value:function(e){_classPrivateFieldGet(this,K).attr("disabled",e)}},{key:"changeMode",value:function(){var a=arguments.length>0&&arguments[0]!==t?arguments[0]:null,i=arguments.length>1&&arguments[1]!==t&&arguments[1];if(null===a)a="sync"===_classPrivateFieldGet(this,Z)?"edit":"sync";else if(-1===e.inArray(a,["sync","edit"]))throw new Error("Invalid mode: "+a);if(_classPrivateFieldGet(this,Z)!==a){var s=_classPrivateFieldGet(this,K).children(),l={edit:"edit",sync:"time"}[a],n="sync"===a?"edit":"sync",r="sync"===a?"edit":"clock";switch(s.first().removeClass("fa-".concat(l)).addClass("fa-".concat(r)).next().text(_classPrivateFieldGet(this,K).attr("data-".concat(n,"mode"))),_classPrivateFieldGet(this,z).removeClass("mode-".concat(n)).addClass("mode-".concat(a)),_classPrivateFieldSet(this,Z,a),_classPrivateFieldGet(this,Z)){case"edit":this.revokeSyncHandle(),_classPrivateFieldGet(this,z).find(".text, .timestamp").attr("contenteditable",!0),_classPrivateFieldGet(this,z).find(".sync-handle").removeClass("sync-handle");break;case"sync":_classPrivateFieldGet(this,z).find(".text, .timestamp").removeAttr("contenteditable");var o=this.getSyncHandle(i);this.scrollHighlightedIntoView(o,!1)}}}},{key:"getTimings",value:function(){return this.timings}},{key:"setTimings",value:function(e){this.timings=e,this.regenEntries(),I.getInstance().updateEntrySticks()}},{key:"setInitialMetadata",value:function(t){var a=this;e.each(["ar","ti","al","length"],(function(e,i){var s=E[i];t[s]?a.initialMetadata[i]=t[s]:null===t[s]&&delete a.initialMetadata[i]}))}},{key:"setMetadata",value:function(e){this.metadata=e}},{key:"getCurrentMetadata",value:function(){return e.extend({},this.initialMetadata,this.metadata)}},{key:"storeTimings",value:function(){var t=_classPrivateFieldGet(this,z).children(),a=[];t.each((function(){var t=e(this),i=t.children(".timestamp").text().trim();if(i.length&&r.isValid(i)){var l=t.children(".text").text().trim().split("\n");e.each(l,(function(e,l){a.push(new s(l,i,t))}))}})),this.timings=a,I.getInstance().updateEntrySticks()}},{key:"makeEntryDiv",value:function(e){var t=_classPrivateFieldGet(this,J).clone();return t.children().first().text(e.ts.toString()).trigger("keyup").next().text(e.str),t}},{key:"regenEntries",value:function(){var t=this;_classPrivateFieldGet(this,z).empty(),e.each(this.timings,(function(e,a){t.timings[e].$domNode=t.makeEntryDiv(a),_classPrivateFieldGet(t,z).append(t.timings[e].$domNode)})),this.passSyncHandle(_classPrivateFieldGet(this,z).children().first()),this.updateEntryActionButtons()}},{key:"updateEntryActionButtons",value:function(){var t=_classPrivateFieldGet(this,z).children();t.find(".remrow").attr("disabled",1===t.length),t.find(".goto").disable().filter((function(){return r.isValid(e(this).parent().siblings().first().text().trim())})).enable()}},{key:"readLRCFile",value:function(t,a){var i=this,s=new FileReader;s.onload=function(){try{var l=new A(s.result);i.setTimings(l.timings),i.setMetadata(l.metadata)}catch(t){return e.Dialog.fail(Laravel.jsLocales.dialog_parse_error,t.message),void a(!1)}_classPrivateFieldSet(i,Y,t.name.replace(/\.lrc$/,"")),a(!0)},s.readAsText(t)}},{key:"getSyncHandle",value:function(){var e=arguments.length>0&&arguments[0]!==t&&arguments[0];if("edit"!==_classPrivateFieldGet(this,Z)){var a=_classPrivateFieldGet(this,z).children();if(a.length){var s=_classPrivateFieldGet(this,z).children(".sync-handle"),l=_classPrivateFieldGet(this,z).children(".nowplaying").removeClass("nowplaying");return e&&!s.length&&(s=l).length&&s.addClass("sync-handle"),s.length||(s=i.giveSyncHandleTo(_classPrivateFieldGet(this,z).children().first())),s}}}},{key:"revokeSyncHandle",value:function(){var e=this.getSyncHandle();return void 0!==e&&e.removeClass("sync-handle nowplaying").removeAttr("title"),e}},{key:"passSyncHandle",value:function(){var e=arguments.length>0&&arguments[0]!==t?arguments[0]:null,a=!(arguments.length>1&&arguments[1]!==t)||arguments[1];if("edit"!==_classPrivateFieldGet(this,Z)){var s=this.revokeSyncHandle();if(null===e&&(e=s.next()),!e.length){if(a)return void this.changeMode("edit");e=s}i.giveSyncHandleTo(e),this.scrollHighlightedIntoView(e,!1)}}},{key:"syncEntry",value:function(){var e=!(arguments.length>0&&arguments[0]!==t)||arguments[0],a=!(arguments.length>1&&arguments[1]!==t)||arguments[1];if("edit"!==_classPrivateFieldGet(this,Z)){var i=this.getSyncHandle(),s=I.getInstance().getPlaybackPosition();if(e){var l=i.prev().find(".timestamp");if(l.text().trim()===s)return void l.removeClass("flash").addClass("flash");i.find(".timestamp").text(s).trigger("keyup")}this.passSyncHandle(null,a),this.storeTimings(),this.updateEntryActionButtons(),I.getInstance().updateEntrySticks()}}},{key:"syncBreakEntry",value:function(){if("edit"!==_classPrivateFieldGet(this,Z)){var e=this.getSyncHandle(),t=I.getInstance().getPlaybackPosition();this.makeEntryDiv(new s("",t)).insertBefore(e).find("[contenteditable]").removeAttr("contenteditable"),this.scrollHighlightedIntoView(e,!1),this.updateEntryActionButtons(),this.storeTimings(),I.getInstance().updateEntrySticks()}}},{key:"undoSync",value:function(){if("edit"!==_classPrivateFieldGet(this,Z)){var e=this.getSyncHandle();0!==e.index()&&(this.passSyncHandle(e.prev()),this.storeTimings(),this.updateEntryActionButtons(),I.getInstance().updateEntrySticks())}}},{key:"emptySync",value:function(){"edit"!==_classPrivateFieldGet(this,Z)&&(this.getSyncHandle().find(".timestamp").empty().trigger("keyup"),this.passSyncHandle(),this.storeTimings(),I.getInstance().updateEntrySticks())}},{key:"hlEntry",value:function(t){if("sync"!==_classPrivateFieldGet(this,Z)&&void 0!==t){var a=this.getTimings(),i=function(e,t){for(var a=0,i=e.length-1;a<=i;){var s=a+(i-a>>1),l=t(e[s]);if(l<0)a=s+1;else{if(!(l>0))return s;i=s-1}}return a-1}(a,(function(e){return e.ts.seconds-t.seconds}));if(i<0)e(".nowplaying").removeClass("nowplaying");else{var s=a[i].$domNode;s.hasClass("nowplaying")||this.scrollHighlightedIntoView(s)}}}},{key:"scrollHighlightedIntoView",value:function(e){var a=!(arguments.length>1&&arguments[1]!==t)||arguments[1];if(a&&e.addClass("nowplaying").siblings().removeClass("nowplaying"),!_classPrivateFieldGet(this,z).is(":hover")){var i=e.position(),s=_classPrivateFieldGet(this,z).position(),l=_classPrivateFieldGet(this,z).scrollTop(),n=l+(i.top-s.top)-_classPrivateFieldGet(this,z).height()/2+e.height()/2;_classPrivateFieldGet(this,z).stop().animate({scrollTop:n},400)}}},{key:"exportLRCFile",value:function(){var a=!(arguments.length>0&&arguments[0]!==t)||arguments[0],i=[];if(a){var s=this.getCurrentMetadata();e.each(s,(function(e,t){if(""!==t){switch(e){case"offset":if("0"===t)return;break;case"length":t=" ".concat(t)}i.push("[".concat(e,":").concat(t,"]"))}}))}if(_classPrivateFieldGet(this,H)){var l={};e.each(this.timings,(function(e,t){void 0===l[t.str]&&(l[t.str]=[]),l[t.str].push(t.ts.toString(!0))})),e.each(l,(function(e,t){i.push("[".concat(t.join("]["),"]").concat(e))}))}else i=[].concat(_toConsumableArray(i),_toConsumableArray(this.timings.map((function(e){return"[".concat(e.ts.toString(!0),"]").concat(e.str)}))));var n=i.join("\n")+"\n",r=_classPrivateFieldGet(this,Y)||I.getInstance().getFileName()||"Lyrics",o="".concat(r,".lrc"),c=new Blob([n],{type:"text/plain;charset=utf-8"});saveAs(c,o)}}],[{key:"getInstance",value:function(){return void 0===a.editor&&(a.editor=new i),a.editor}},{key:"giveSyncHandleTo",value:function(e){return e.addClass("sync-handle"),e.find(".timestamp").focus(),e}},{key:"getMergedOutputStrategyDefault",value:function(){if(!window.localStorage)return!0;var e=localStorage.getItem("lrc-merge");return e&&"false"===e||(e="true",localStorage.setItem("lrc-merge",e)),"true"===e}}]),i}();function ie(){_classPrivateFieldSet(this,H,!_classPrivateFieldGet(this,H)),window.localStorage&&localStorage.setItem("lrc-merge",_classPrivateFieldGet(this,H)?"true":"false"),_classPrivateMethodGet(this,te,se).call(this)}function se(){var e=_classPrivateFieldGet(this,q).find(".status");_classPrivateFieldGet(this,H)?e.addClass("text-success").removeClass("text-danger"):e.removeClass("text-success").addClass("text-danger"),e.text(e.attr("data-".concat(_classPrivateFieldGet(this,H)?"true":"false")))}I.getInstance(),ae.getInstance(),$d.on("keydown",e.throttle(200,(function(e){var t=e.target.tagName.toLowerCase();if(("input"!==t||"file"===e.target.type)&&"textarea"!==t&&null===e.target.getAttribute("contenteditable")){switch(e.keyCode){case Key.LeftArrow:a.player.seek(-2.5*(e.shiftKey?2:1));break;case Key.RightArrow:a.player.seek(2.5*(e.shiftKey?2:1));break;case Key.PageUp:a.player.$volumeup.trigger("click",[e.shiftKey,e.altKey]);break;case Key.PageDown:a.player.$volumedown.trigger("click",[e.shiftKey,e.altKey]);break;case Key.Space:a.player.$playbackbtn.trigger("click");break;case Key.Period:a.player.$stopbtn.trigger("click");break;case Key.Enter:e.ctrlKey&&!e.altKey?a.editor.syncBreakEntry():a.editor.syncEntry();break;case Key.UpArrow:a.editor.undoSync();break;case Key.DownArrow:a.editor.syncEntry(!1,!1);break;case Key.Delete:a.editor.emptySync();break;default:return}e.preventDefault()}}))),$d.on("paste","[contenteditable]",(function(t){var a="",i=e(this);if(t.clipboardData?a=t.clipboardData.getData("text/plain"):window.clipboardData?a=window.clipboardData.getData("Text"):t.originalEvent.clipboardData&&(a=e.mk("div").text(t.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText"))return document.execCommand("insertHTML",!1,e(a).html()),!1;i.find("*").each((function(){e(this).addClass("within")})),setTimeout((function(){i.find("*").each((function(){e(this).not(".within").contents().unwrap()}))}),1)})).on("keyup","[contenteditable]",(function(){var t=e(this);0===t.text().trim().length&&t.empty()}));var le=e("#info-shortcuts-template");"string"==typeof navigator.userAgent&&/(macos|iphone|os ?x|ip[ao]d)/i.test(navigator.userAgent)&&(le.find("kbd:contains(Shift)").html("&#x2325;"),le.find("kbd:contains(Ctrl)").html("&#x2318;")),e("#shortcut-info").on("click",(function(t){t.preventDefault();var a=e(this).attr("title");e.Dialog.info(a,le.clone().children())})),window.Plugin=a}(jQuery);
//# sourceMappingURL=../maps/lrc.js.map
