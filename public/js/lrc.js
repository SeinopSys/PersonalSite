"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=new Array(t);a<t;a++)i[a]=e[a];return i}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],i=!0,s=!1,l=void 0;try{for(var n,r=e[Symbol.iterator]();!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){s=!0,l=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw l}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _classPrivateFieldGet(e,t){var a=t.get(e);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(e):a.value}function _classPrivateMethodGet(e,t,a){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return a}function _classPrivateFieldSet(e,t,a){var i=t.get(e);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(e,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){window.URL=window.URL||window.webkitURL;var a={player:void 0,editor:void 0};function i(t){return 100*e.roundTo(t,5)+"%"}var s=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.str=t.trim(),this.ts=a instanceof l?a:new l(a),this.$domNode=i},l=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(_classCallCheck(this,t),r.add(this),n.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,n,a),_typeof(e)){case"string":_classPrivateMethodGet(this,r,o).call(this,e);break;case"number":this.seconds=parseFloat(parseFloat(e).toFixed(2)),_classPrivateFieldGet(this,n)&&(this.seconds=Math.ceil(this.seconds))}}return _createClass(t,[{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0===this.seconds)return"";var a=this.seconds,i=Math.floor(a/60);i>0&&(a-=60*i);var s=t?e.pad(i):String(i),l=a.toFixed(2).split("."),r=_slicedToArray(l,2),o=r[0],c=r[1];return"".concat(s,":").concat(e.pad(o)).concat(_classPrivateFieldGet(this,n)?"":".".concat(c))}}],[{key:"isValid",value:function(e){return/(?:\d+:)?[0-5]?\d:[0-5]\d(?:\.\d{1,2})?/.test(e)}}]),t}(),n=new WeakMap,r=new WeakSet,o=function(e){if(l.isValid(e)){var t=e.split(":"),a=parseFloat(t.pop());t.length&&(a+=60*parseInt(t.pop(),10)),this.seconds=a}else this.seconds=NaN},c=function(){function t(e){_classCallCheck(this,t),d.set(this,{writable:!0,value:void 0}),u.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,d,e),_classPrivateFieldSet(this,u,_classPrivateFieldGet(this,d).find(".status-position")),_classPrivateFieldSet(this,v,_classPrivateFieldGet(this,d).find(".status-duration")),_classPrivateFieldSet(this,h,_classPrivateFieldGet(this,d).find(".status-filename")),_classPrivateFieldSet(this,p,_classPrivateFieldGet(this,d).find(".status-filetype")),this.$progressWrap=_classPrivateFieldGet(this,d).find(".progress-wrap"),_classPrivateFieldSet(this,f,_classPrivateFieldGet(this,d).find(".progress-indicator .fill")),_classPrivateFieldSet(this,y,_classPrivateFieldGet(this,d).find(".progress-indicator .loaded")),_classPrivateFieldSet(this,g,_classPrivateFieldGet(this,d).find(".progress-indicator .entry-sticks")),_classPrivateFieldSet(this,m,_classPrivateFieldGet(this,d).find(".thumb")),this.setFileName(),this.setProgress(),this.showThumb()}return _createClass(t,[{key:"setFileName",value:function(e,t){_classPrivateFieldGet(this,h).text(e?e.replace(/\.[^.]+$/,""):""),_classPrivateFieldGet(this,p).text(t?t.split("/")[1].toUpperCase():"")}},{key:"getFileName",value:function(){return _classPrivateFieldGet(this,h).text().trim()}},{key:"setProgress",value:function(e,t){if(void 0===e&&void 0===t)return _classPrivateFieldGet(this,u).html("&hellip;"),void _classPrivateFieldGet(this,v).html("&hellip;");var a=e||0,i=t||0;_classPrivateFieldGet(this,u).text(new l(a)),_classPrivateFieldGet(this,v).text(new l(i)),this.updateSeek(a,i)}},{key:"setLoaded",value:function(t,a){_classPrivateFieldGet(this,y).empty();for(var s=0;s<t.length;s++){var l=t.start(s),n=t.end(s);_classPrivateFieldGet(this,y).append(e.mk("div").css({left:i(l/a),width:i((n-l)/a)}))}}},{key:"setEntries",value:function(t,a){var s=this;_classPrivateFieldGet(this,g).empty(),e.each(t,(function(t,l){_classPrivateFieldGet(s,g).append(e.mk("div").css({left:i(l.ts.seconds/a)}))}))}},{key:"updateSeek",value:function(e,t){var a=i(e/t);_classPrivateFieldGet(this,f).css("width",a),_classPrivateFieldGet(this,m).css("left",a)}},{key:"showThumb",value:function(e){_classPrivateFieldGet(this,d)[e?"addClass":"removeClass"]("playing")}}]),t}(),d=new WeakMap,u=new WeakMap,v=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,y=new WeakMap,g=new WeakMap,m=new WeakMap,_=function(){function t(){var a=this;_classCallCheck(this,t),I.add(this),T.add(this),P.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,P,e("#player")),_classPrivateFieldSet(this,F,e.mk("input","audiofilein").attr({type:"file",accept:"audio/*",tabindex:-1,class:"fileinput"}).appendTo($body)),_classPrivateFieldSet(this,k,e("#audiofilebtn")),this.$playbackbtn=e("#playbackbtn"),_classPrivateFieldSet(this,b,new Audio),_classPrivateFieldGet(this,b).preload="auto",this.$stopbtn=e("#stopbtn"),e(_classPrivateFieldGet(this,b)).on("ended",(function(){a.stop(),a.updatePlaybackButtons()})).on("loadeddata",(function(){_classPrivateFieldGet(a,M).setProgress(),a.updateInd(),_classPrivateFieldGet(a,k).enable(),a.updatePlaybackButtons(),_classPrivateFieldGet(a,M).showThumb(!0),a.updateEntrySticks(),a.setMetadataLength()})),_classPrivateFieldSet(this,w,{}),_classPrivateFieldSet(this,G,.05),_classPrivateFieldSet(this,S,e("#volumedisp")),this.$volumedown=e("#volumedown"),this.$volumeup=e("#volumeup");var i,s=t.getSessionVolume();this.volume(s),this.updateVolumeButtons(s),_classPrivateFieldSet(this,C,void 0),_classPrivateFieldSet(this,M,new c(_classPrivateFieldGet(this,P).find(".state"))),_classPrivateFieldGet(this,M).$progressWrap.on("mousedown",(function(e){1===e.which&&a.hasFile()&&(e.preventDefault(),_classPrivateFieldGet(a,M).$progressWrap.addClass("moving"),i=!_classPrivateFieldGet(a,b).paused,a.pause(),a.updatePlaybackButtons())})),$d.on("mouseup",(function(e){1===e.which&&_classPrivateFieldGet(a,M).$progressWrap.hasClass("moving")&&a.hasFile()&&(a.recalcThumbPos(e),_classPrivateFieldGet(a,M).$progressWrap.removeClass("moving"),i&&(a.play(),a.updatePlaybackButtons()))})),$d.on("mousemove",e.throttle(100,(function(e){_classPrivateFieldGet(a,M).$progressWrap.hasClass("moving")&&a.hasFile()&&a.recalcThumbPos(e)}))),this.$stopbtn.on("click",(function(e){e.preventDefault(),a.hasFile()&&(a.stop(),a.updatePlaybackButtons())})),this.$playbackbtn.on("click",(function(e){e.preventDefault(),a.hasFile()&&(_classPrivateFieldGet(a,b).paused?a.play():a.pause(),a.updatePlaybackButtons())})),this.$volumedown.on("click",(function(e,t,i){e.preventDefault();var s=a.volume()-(e.altKey||i?.01:_classPrivateFieldGet(a,G)*(e.shiftKey||t?2:1));a.updateVolumeButtons(s),a.volume(s)})),this.$volumeup.on("click",(function(e,t,i){e.preventDefault();var s=a.volume()+(e.altKey||i?.01:_classPrivateFieldGet(a,G)*(e.shiftKey||t?2:1));a.updateVolumeButtons(s),a.volume(s)})),_classPrivateFieldGet(this,k).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,F).trigger("click")})),_classPrivateFieldGet(this,F).on("change",(function(){_classPrivateFieldGet(a,F).val()&&(a.clearFile(),_classPrivateFieldGet(a,k).disable(),a.setFile(_classPrivateFieldGet(a,F)[0].files[0],(function(e){_classPrivateFieldGet(a,M).setFileName(e.name,e.type)})))}))}return _createClass(t,[{key:"volume",value:function(t){if(void 0===t)return _classPrivateFieldGet(this,b).volume;t=e.rangeLimit(e.roundTo(t,2),!1,0,1),_classPrivateFieldGet(this,S).text(e.pad(Math.round(100*t)," ",3)+"%"),window.localStorage&&localStorage.setItem("lrc-vol",t),_classPrivateFieldGet(this,b).volume=t}},{key:"updateVolumeButtons",value:function(e){this.$volumeup.attr("disabled",e>=1),this.$volumedown.attr("disabled",e<=0)}},{key:"updatePlaybackButtons",value:function(){var e=!this.hasFile();this.$playbackbtn.attr("disabled",e),this.$stopbtn.attr("disabled",e),H.getInstance().disableModeButton(e),this.$playbackbtn.removeClass("btn-success btn-danger").children().removeClass("fa-play fa-pause"),_classPrivateFieldGet(this,b).paused?this.$playbackbtn.addClass("btn-success").children().addClass("fa-play"):this.$playbackbtn.addClass("btn-danger").children().addClass("fa-pause")}},{key:"play",value:function(){_classPrivateFieldGet(this,b).paused&&(_classPrivateFieldGet(this,b).play(),_classPrivateMethodGet(this,T,x).call(this),_classPrivateFieldGet(this,M).showThumb(!0))}},{key:"pause",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_classPrivateMethodGet(this,I,L).call(this),_classPrivateFieldGet(this,b).paused||(_classPrivateFieldGet(this,b).pause(),e||this.updateInd())}},{key:"stop",value:function(){this.pause(!0),_classPrivateFieldGet(this,b).currentTime=0,this.updateInd()}},{key:"seek",value:function(t){this.hasFile()&&(_classPrivateFieldGet(this,b).currentTime=e.rangeLimit(_classPrivateFieldGet(this,b).currentTime+t,!1,0,_classPrivateFieldGet(this,b).duration),this.updateInd())}},{key:"setFile",value:function(t,a){var i=this;this.stop(),_classPrivateFieldGet(this,M).showThumb(!1),this.updatePlaybackButtons(),/^audio\//.test(t.type)?(_classPrivateFieldGet(this,b).src=URL.createObjectURL(t),new jsmediatags.Reader(t).setTagsToRead(["title","artist","album"]).read({onSuccess:function(e){"object"===_typeof(e)&&i.setMediaTags(e.tags)},onError:function(e){console.log("Failed to read ID3 tags",e.type,e.info)}}),a(t)):e.Dialog.fail(Laravel.jsLocales.dialog_format_error,Laravel.jsLocales.dialog_format_notaudio)}},{key:"hasFile",value:function(){return 0!==_classPrivateFieldGet(this,b).readyState}},{key:"clearFile",value:function(){this.stop(),_classPrivateFieldGet(this,b).src&&URL.revokeObjectURL(_classPrivateFieldGet(this,b).src),_classPrivateFieldGet(this,b).src="",this.clearMediaTags()}},{key:"getFileName",value:function(){var e=_classPrivateFieldGet(this,w);return e.title?e.artist?"".concat(e.artist," - ").concat(e.title):e.title:_classPrivateFieldGet(this,M).getFileName()}},{key:"clearMediaTags",value:function(){_classPrivateFieldSet(this,w,{}),H.getInstance().setInitialMetadata({length:null})}},{key:"setMediaTags",value:function(e){if("object"!==_typeof(e))throw new Error("setMediaTags: tags must be an object, ".concat(_typeof(e)," given."));_classPrivateFieldSet(this,w,e),H.getInstance().setInitialMetadata(_classPrivateFieldGet(this,w))}},{key:"getMediaTags",value:function(){return _classPrivateFieldGet(this,w)}},{key:"updateInd",value:function(){_classPrivateFieldGet(this,M).setProgress(_classPrivateFieldGet(this,b).currentTime,_classPrivateFieldGet(this,b).duration),_classPrivateFieldGet(this,M).setLoaded(_classPrivateFieldGet(this,b).buffered,_classPrivateFieldGet(this,b).duration),H.getInstance().hlEntry(this.getPlaybackPosition())}},{key:"updateEntrySticks",value:function(){this.hasFile()&&_classPrivateFieldGet(this,M).setEntries(H.getInstance().getTimings(),_classPrivateFieldGet(this,b).duration)}},{key:"setMetadataLength",value:function(){H.getInstance().setInitialMetadata({length:new l(_classPrivateFieldGet(this,b).duration,!0)})}},{key:"getPlaybackPosition",value:function(){if(this.hasFile())return new l(_classPrivateFieldGet(this,b).currentTime)}},{key:"setPlaybackPosition",value:function(e){this.hasFile()&&l.isValid(e)&&(_classPrivateFieldGet(this,b).currentTime=new l(e).seconds,this.updateInd())}},{key:"recalcThumbPos",value:function(t){var a=_classPrivateFieldGet(this,M).$progressWrap.offset(),i=parseInt(_classPrivateFieldGet(this,M).$progressWrap.css("width"),10),s=e.rangeLimit(t.clientX-a.left,!1,0,i-1e-5);_classPrivateFieldGet(this,b).currentTime=_classPrivateFieldGet(this,b).duration*(s/i),_classPrivateFieldGet(this,M).updateSeek(s,i),this.updateInd()}}],[{key:"getInstance",value:function(){return void 0===a.player&&(a.player=new t),a.player}},{key:"getSessionVolume",value:function(){if(!window.localStorage)return.5;var e=localStorage.getItem("lrc-vol");return e&&!isNaN(e)||(e="0.5",localStorage.setItem("lrc-vol",e)),parseFloat(e)}}]),t}(),P=new WeakMap,F=new WeakMap,k=new WeakMap,b=new WeakMap,w=new WeakMap,G=new WeakMap,S=new WeakMap,C=new WeakMap,M=new WeakMap,T=new WeakSet,I=new WeakSet,x=function(){var e=this;_classPrivateMethodGet(this,I,L).call(this),_classPrivateFieldSet(this,C,setInterval((function(){e.updateInd()}),85))},L=function(){void 0!==_classPrivateFieldGet(this,C)&&(clearInterval(_classPrivateFieldGet(this,C)),_classPrivateFieldSet(this,C,void 0))},D={ar:"artist",ti:"title",al:"album",au:"lyrics_author",length:"length",by:"file_author",offset:"offset",re:"created_with",ve:"version"},E=/\[([\d:.]+)]/g,W=new RegExp("^\\[(".concat(Object.keys(D).join("|"),"):([^\\]]+)]$")),A=function t(a){var i=this;if(_classCallCheck(this,t),this.timings=[],this.metadata={},0===a.trim().length)throw new Error(Laravel.jsLocales.dialog_parse_error_empty);var l=a.trim().split("\n");e.each(l,(function(t,a){var l=a.match(E);if(l){var n=a.replace(E,"");e.each(l,(function(e,t){i.timings.push(new s(n,t.substring(1,t.length-2)))}))}else{var r=a.trim(),o=r.match(W);console.log(r),o&&(i.metadata[o[1]]=o[2])}})),this.timings.sort((function(e,t){return e.ts.seconds-t.ts.seconds}))},$=function(){function t(a){var i=this;_classCallCheck(this,t),j.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,j,e.mk("form","metadata-editing-form")),e.each(D,(function(t,s){var l="meta_input_".concat(t),n={type:"text",name:t,id:l,value:a[t],class:"form-control"};"offset"===t&&(n.type="number",n.step="0.001",n.min="0",n.placeholder="0",n.value===n.placeholder&&(n.value="")),_classPrivateFieldGet(i,j).append(e.mk("div").attr("class","form-group").append(e.mk("label").attr({for:l}).append(Laravel.jsLocales.metadata_field_placeholders[s]," <code>".concat(t,"</code>")),e.mk("input").attr(n)))})),_classPrivateFieldGet(this,j).prepend(e.mk("div").attr("class"," alert alert-info text-center").append(e.mk("span").text(Laravel.jsLocales.dialog_edit_meta_reset_info),mk("br"),e.mk("button").attr({class:"btn btn-info",type:"reset"}).text(Laravel.jsLocales.dialog_edit_meta_reset_btn).prepend('<i class="fa fa-undo"/>')))}return _createClass(t,[{key:"get",value:function(){return _classPrivateFieldGet(this,j).clone()}}]),t}(),j=new WeakMap,H=function(){function t(){var a=this;_classCallCheck(this,t),ae.add(this),te.add(this),B.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:void 0}),V.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),Q.set(this,{writable:!0,value:void 0}),X.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),J.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,K,e("#timings")),_classPrivateFieldSet(this,R,e("#lrcmodebtn")),_classPrivateFieldSet(this,V,e("#lrcfilebtn")),_classPrivateFieldSet(this,N,e.mk("input","lrcfilein").attr({type:"file",accept:".lrc",tabindex:-1,class:"fileinput"}).appendTo($body)),_classPrivateFieldSet(this,U,e("#lrcpastebtn")),_classPrivateFieldSet(this,O,e("#lrcexportbtn")),_classPrivateFieldSet(this,q,e("#lrcexportnometabtn")),_classPrivateFieldSet(this,Q,e("#lrcmergetogglebtn")),_classPrivateFieldSet(this,X,e("#lrcclrbtn")),_classPrivateFieldSet(this,z,e("#lrcmetadatabtn")),_classPrivateFieldSet(this,J,_classPrivateFieldGet(this,K).find(".editor")),_classPrivateFieldSet(this,Y,e("#editor-entry-template").children()),this.changeMode("edit"),this.timings=[],this.initialMetadata={offset:"0",re:"".concat(window.location.href," - SeinopSys' LRC Editor"),ve:window.Laravel.git.commit_id},this.metadata={},_classPrivateFieldGet(this,J).append(this.makeEntryDiv(new s)),_classPrivateFieldSet(this,Z,void 0),_classPrivateFieldSet(this,B,t.getMergedOutputStrategyDefault()),_classPrivateMethodGet(this,ae,se).call(this),_classPrivateFieldGet(this,R).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,R).is("[disabled]")||a.changeMode(null,e.altKey)})),_classPrivateFieldGet(this,U).on("click",(function(t){t.preventDefault();var i=e.mk("form","rawlyrics").append('<div class="form-group">\n\t\t\t\t\t\t<textarea class="form-control" rows="10"></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="text-info"><span class="fa fa-info-circle"></span> '.concat(Laravel.jsLocales.dialog_pasteraw_info,"</p>"));e.Dialog.request(Laravel.jsLocales.dialog_pasteraw_title,i,Laravel.jsLocales.dialog_pasteraw_action,(function(t){t.on("submit",(function(i){i.preventDefault(),e.Dialog.wait(!1,"Importing");var l=t.find("textarea").val().trim().split(/\n+/g);l.push(""),a.timings=l.map((function(e){return new s(e)})),_.getInstance().updateEntrySticks(),a.regenEntries(),_classPrivateFieldSet(a,Z,void 0),e.Dialog.close()}))}))})),_classPrivateFieldGet(this,O).on("click",(function(e){e.preventDefault(),a.storeTimings(),a.exportLRCFile()})),_classPrivateFieldGet(this,q).on("click",(function(e){e.preventDefault(),a.storeTimings(),a.exportLRCFile(!1)})),_classPrivateFieldGet(this,Q).on("click",(function(e){e.preventDefault(),_classPrivateMethodGet(a,te,ie).call(a)})),_classPrivateFieldGet(this,X).on("click",(function(t){t.preventDefault(),e.Dialog.confirm(e(t.target).text(),void 0,(function(t){t&&(_classPrivateFieldGet(a,J).empty(),_classPrivateFieldGet(a,J).append(a.makeEntryDiv(new s)),a.storeTimings(),e.Dialog.close())}))})),_classPrivateFieldGet(this,z).on("click",(function(t){t.preventDefault();var i=new $(a.getCurrentMetadata()).get();e.Dialog.request(Laravel.jsLocales.dialog_edit_meta,i,Laravel.jsLocales.save,(function(){i.on("submit",(function(t){t.preventDefault();var s=i.mkData();e.each(D,(function(e){a.metadata[e]=s[e].trim()})),e.Dialog.close()})),i.on("reset",(function(t){t.preventDefault(),a.metadata={};var s=a.getCurrentMetadata();e.each(D,(function(e){i.find("input[name=".concat(e,"]")).val(s[e])}))}))}))})),_classPrivateFieldGet(this,J).on("mouseenter",(function(){_classPrivateFieldGet(a,J).stop()})),_classPrivateFieldGet(this,J).on("keyup",".timestamp",(function(t){if("edit"===_classPrivateFieldGet(a,ee)){var i=e(t.target),s=i.text().trim(),n=!l.isValid(s);i[s.length&&n?"addClass":"removeClass"]("invalid"),i.siblings(".tools").children(".goto").attr("disabled",n),_.getInstance().updateEntrySticks()}})),_classPrivateFieldGet(this,J).on("click",".addrow-up, .addrow-down",(function(t){t.preventDefault();var i="up"===e(t.target).closest("button").attr("class").match(/addrow-(up|down)/)[1]?"insertBefore":"insertAfter",l=a.makeEntryDiv(new s)[i](e(t.target).closest(".time-entry"));a.updateEntryActionButtons(),a.storeTimings(),l.addClass("new"),a.scrollHighlightedIntoView(l,!1)})),_classPrivateFieldGet(this,J).on("click",".remrow",(function(t){t.preventDefault();var i=e(t.target).closest(".time-entry");0!==i.siblings().length&&(i.remove(),a.updateEntryActionButtons(),a.storeTimings(),a.hlEntry(_.getInstance().getPlaybackPosition()))})),_classPrivateFieldGet(this,J).on("click",".goto",(function(t){t.preventDefault();var i=e(t.target).closest(".goto");if(!i.is(":disabled")){var s=i.parents(".time-entry"),l=s.find(".timestamp").text();_.getInstance().setPlaybackPosition(l),"sync"===_classPrivateFieldGet(a,ee)&&a.passSyncHandle(s)}})),_classPrivateFieldGet(this,V).on("click",(function(e){e.preventDefault(),_classPrivateFieldGet(a,N).trigger("click")})),_classPrivateFieldGet(this,N).on("change",(function(){_classPrivateFieldGet(a,N).val()&&(_classPrivateFieldGet(a,V).disable(),a.readLRCFile(_classPrivateFieldGet(a,N)[0].files[0],(function(e){e?a.regenEntries():_classPrivateFieldGet(a,N).val(""),_classPrivateFieldGet(a,V).enable()})))}))}return _createClass(t,[{key:"disableModeButton",value:function(e){_classPrivateFieldGet(this,R).attr("disabled",e)}},{key:"changeMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===t)t="sync"===_classPrivateFieldGet(this,ee)?"edit":"sync";else if(-1===e.inArray(t,["sync","edit"]))throw new Error("Invalid mode: "+t);if(_classPrivateFieldGet(this,ee)!==t){var i=_classPrivateFieldGet(this,R).children(),s={edit:"edit",sync:"time"}[t],l="sync"===t?"edit":"sync",n="sync"===t?"edit":"clock";switch(i.first().removeClass("fa-".concat(s)).addClass("fa-".concat(n)).next().text(_classPrivateFieldGet(this,R).attr("data-".concat(l,"mode"))),_classPrivateFieldGet(this,J).removeClass("mode-".concat(l)).addClass("mode-".concat(t)),_classPrivateFieldSet(this,ee,t),_classPrivateFieldGet(this,ee)){case"edit":this.revokeSyncHandle(),_classPrivateFieldGet(this,J).find(".text, .timestamp").attr("contenteditable",!0),_classPrivateFieldGet(this,J).find(".sync-handle").removeClass("sync-handle");break;case"sync":_classPrivateFieldGet(this,J).find(".text, .timestamp").removeAttr("contenteditable");var r=this.getSyncHandle(a);this.scrollHighlightedIntoView(r,!1)}}}},{key:"getTimings",value:function(){return this.timings}},{key:"setTimings",value:function(e){this.timings=e,this.regenEntries(),_.getInstance().updateEntrySticks()}},{key:"setInitialMetadata",value:function(t){var a=this;e.each(["ar","ti","al","length"],(function(e,i){var s=D[i];t[s]?a.initialMetadata[i]=t[s]:null===t[s]&&delete a.initialMetadata[i]}))}},{key:"setMetadata",value:function(e){this.metadata=e}},{key:"getCurrentMetadata",value:function(){return e.extend({},this.initialMetadata,this.metadata)}},{key:"storeTimings",value:function(){var t=_classPrivateFieldGet(this,J).children(),a=[];t.each((function(){var t=e(this),i=t.children(".timestamp").text().trim();if(i.length&&l.isValid(i)){var n=t.children(".text").text().trim().split("\n");e.each(n,(function(e,l){a.push(new s(l,i,t))}))}})),this.timings=a,_.getInstance().updateEntrySticks()}},{key:"makeEntryDiv",value:function(e){var t=_classPrivateFieldGet(this,Y).clone();return t.children().first().text(e.ts.toString()).trigger("keyup").next().text(e.str),t}},{key:"regenEntries",value:function(){var t=this;_classPrivateFieldGet(this,J).empty(),e.each(this.timings,(function(e,a){t.timings[e].$domNode=t.makeEntryDiv(a),_classPrivateFieldGet(t,J).append(t.timings[e].$domNode)})),this.passSyncHandle(_classPrivateFieldGet(this,J).children().first()),this.updateEntryActionButtons()}},{key:"updateEntryActionButtons",value:function(){var t=_classPrivateFieldGet(this,J).children();t.find(".remrow").attr("disabled",1===t.length),t.find(".goto").disable().filter((function(){return l.isValid(e(this).parent().siblings().first().text().trim())})).enable()}},{key:"readLRCFile",value:function(t,a){var i=this,s=new FileReader;s.onload=function(){try{var l=new A(s.result);i.setTimings(l.timings),i.setMetadata(l.metadata)}catch(t){return e.Dialog.fail(Laravel.jsLocales.dialog_parse_error,t.message),void a(!1)}_classPrivateFieldSet(i,Z,t.name.replace(/\.lrc$/,"")),a(!0)},s.readAsText(t)}},{key:"getSyncHandle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("edit"!==_classPrivateFieldGet(this,ee)){var a=_classPrivateFieldGet(this,J).children();if(a.length){var i=_classPrivateFieldGet(this,J).children(".sync-handle"),s=_classPrivateFieldGet(this,J).children(".nowplaying").removeClass("nowplaying");return e&&!i.length&&(i=s).length&&i.addClass("sync-handle"),i.length||(i=t.giveSyncHandleTo(_classPrivateFieldGet(this,J).children().first())),i}}}},{key:"revokeSyncHandle",value:function(){var e=this.getSyncHandle();return void 0!==e&&e.removeClass("sync-handle nowplaying").removeAttr("title"),e}},{key:"passSyncHandle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("edit"!==_classPrivateFieldGet(this,ee)){var i=this.revokeSyncHandle();if(null===e&&(e=i.next()),!e.length){if(a)return void this.changeMode("edit");e=i}t.giveSyncHandleTo(e),this.scrollHighlightedIntoView(e,!1)}}},{key:"syncEntry",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("edit"!==_classPrivateFieldGet(this,ee)){var a=this.getSyncHandle(),i=_.getInstance().getPlaybackPosition();if(e){var s=a.prev().find(".timestamp");if(s.text().trim()===i)return void s.removeClass("flash").addClass("flash");a.find(".timestamp").text(i).trigger("keyup")}this.passSyncHandle(null,t),this.storeTimings(),this.updateEntryActionButtons(),_.getInstance().updateEntrySticks()}}},{key:"syncBreakEntry",value:function(){if("edit"!==_classPrivateFieldGet(this,ee)){var e=this.getSyncHandle(),t=_.getInstance().getPlaybackPosition();this.makeEntryDiv(new s("",t)).insertBefore(e).find("[contenteditable]").removeAttr("contenteditable"),this.scrollHighlightedIntoView(e,!1),this.updateEntryActionButtons(),this.storeTimings(),_.getInstance().updateEntrySticks()}}},{key:"undoSync",value:function(){if("edit"!==_classPrivateFieldGet(this,ee)){var e=this.getSyncHandle();0!==e.index()&&(this.passSyncHandle(e.prev()),this.storeTimings(),this.updateEntryActionButtons(),_.getInstance().updateEntrySticks())}}},{key:"emptySync",value:function(){"edit"!==_classPrivateFieldGet(this,ee)&&(this.getSyncHandle().find(".timestamp").empty().trigger("keyup"),this.passSyncHandle(),this.storeTimings(),_.getInstance().updateEntrySticks())}},{key:"hlEntry",value:function(t){if("sync"!==_classPrivateFieldGet(this,ee)&&void 0!==t){var a=this.getTimings(),i=function(e,t){for(var a=0,i=e.length-1;a<=i;){var s=a+(i-a>>1),l=t(e[s]);if(l<0)a=s+1;else{if(!(l>0))return s;i=s-1}}return a-1}(a,(function(e){return e.ts.seconds-t.seconds}));if(i<0)e(".nowplaying").removeClass("nowplaying");else{var s=a[i].$domNode;s.hasClass("nowplaying")||this.scrollHighlightedIntoView(s)}}}},{key:"scrollHighlightedIntoView",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&e.addClass("nowplaying").siblings().removeClass("nowplaying"),!_classPrivateFieldGet(this,J).is(":hover")){var a=e.position(),i=_classPrivateFieldGet(this,J).position(),s=_classPrivateFieldGet(this,J).scrollTop(),l=s+(a.top-i.top)-_classPrivateFieldGet(this,J).height()/2+e.height()/2;_classPrivateFieldGet(this,J).stop().animate({scrollTop:l},400)}}},{key:"exportLRCFile",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=[];if(t){var i=this.getCurrentMetadata();e.each(i,(function(e,t){if(""!==t){switch(e){case"offset":if("0"===t)return;break;case"length":t=" ".concat(t)}a.push("[".concat(e,":").concat(t,"]"))}}))}if(_classPrivateFieldGet(this,B)){var s={};e.each(this.timings,(function(e,t){void 0===s[t.str]&&(s[t.str]=[]),s[t.str].push(t.ts.toString(!0))})),e.each(s,(function(e,t){a.push("[".concat(t.join("]["),"]").concat(e))}))}else a=[].concat(_toConsumableArray(a),_toConsumableArray(this.timings.map((function(e){return"[".concat(e.ts.toString(!0),"]").concat(e.str)}))));var l=a.join("\n")+"\n",n=_classPrivateFieldGet(this,Z)||_.getInstance().getFileName()||"Lyrics",r="".concat(n,".lrc"),o=new Blob([l],{type:"text/plain;charset=utf-8"});saveAs(o,r)}}],[{key:"getInstance",value:function(){return void 0===a.editor&&(a.editor=new t),a.editor}},{key:"giveSyncHandleTo",value:function(e){return e.addClass("sync-handle"),e.find(".timestamp").focus(),e}},{key:"getMergedOutputStrategyDefault",value:function(){if(!window.localStorage)return!0;var e=localStorage.getItem("lrc-merge");return e&&"false"===e||(e="true",localStorage.setItem("lrc-merge",e)),"true"===e}}]),t}(),B=new WeakMap,K=new WeakMap,R=new WeakMap,V=new WeakMap,N=new WeakMap,U=new WeakMap,O=new WeakMap,q=new WeakMap,Q=new WeakMap,X=new WeakMap,z=new WeakMap,J=new WeakMap,Y=new WeakMap,Z=new WeakMap,ee=new WeakMap,te=new WeakSet,ae=new WeakSet,ie=function(){_classPrivateFieldSet(this,B,!_classPrivateFieldGet(this,B)),window.localStorage&&localStorage.setItem("lrc-merge",_classPrivateFieldGet(this,B)?"true":"false"),_classPrivateMethodGet(this,ae,se).call(this)},se=function(){var e=_classPrivateFieldGet(this,Q).find(".status");_classPrivateFieldGet(this,B)?e.addClass("text-success").removeClass("text-danger"):e.removeClass("text-success").addClass("text-danger"),e.text(e.attr("data-".concat(_classPrivateFieldGet(this,B)?"true":"false")))};_.getInstance(),H.getInstance(),$d.on("keydown",e.throttle(200,(function(e){var t=e.target.tagName.toLowerCase();if(("input"!==t||"file"===e.target.type)&&"textarea"!==t&&null===e.target.getAttribute("contenteditable")){switch(e.keyCode){case Key.LeftArrow:a.player.seek(-2.5*(e.shiftKey?2:1));break;case Key.RightArrow:a.player.seek(2.5*(e.shiftKey?2:1));break;case Key.PageUp:a.player.$volumeup.trigger("click",[e.shiftKey,e.altKey]);break;case Key.PageDown:a.player.$volumedown.trigger("click",[e.shiftKey,e.altKey]);break;case Key.Space:a.player.$playbackbtn.trigger("click");break;case Key.Period:a.player.$stopbtn.trigger("click");break;case Key.Enter:e.ctrlKey&&!e.altKey?a.editor.syncBreakEntry():a.editor.syncEntry();break;case Key.UpArrow:a.editor.undoSync();break;case Key.DownArrow:a.editor.syncEntry(!1,!1);break;case Key.Delete:a.editor.emptySync();break;default:return}e.preventDefault()}}))),$d.on("paste","[contenteditable]",(function(t){var a="",i=e(this);if(t.clipboardData?a=t.clipboardData.getData("text/plain"):window.clipboardData?a=window.clipboardData.getData("Text"):t.originalEvent.clipboardData&&(a=e.mk("div").text(t.originalEvent.clipboardData.getData("text"))),document.queryCommandSupported("insertText"))return document.execCommand("insertHTML",!1,e(a).html()),!1;i.find("*").each((function(){e(this).addClass("within")})),setTimeout((function(){i.find("*").each((function(){e(this).not(".within").contents().unwrap()}))}),1)})).on("keyup","[contenteditable]",(function(){var t=e(this);0===t.text().trim().length&&t.empty()}));var le=e("#info-shortcuts-template");"string"==typeof navigator.userAgent&&/(macos|iphone|os ?x|ip[ao]d)/i.test(navigator.userAgent)&&(le.find("kbd:contains(Shift)").html("&#x2325;"),le.find("kbd:contains(Ctrl)").html("&#x2318;")),e("#shortcut-info").on("click",(function(t){t.preventDefault();var a=e(this).attr("title");e.Dialog.info(a,le.clone().children())})),window.Plugin=a}(jQuery);
//# sourceMappingURL=../maps/lrc.js.map
