{"version":3,"sources":["uploads.js"],"names":["$","$uploadToggle","on","e","preventDefault","action","hasClass","title","attr","content","Dialog","confirm","sure","wait","post","concat","mkAjaxHandler","this","status","fail","message","success","setTimeout","window","location","reload","$revealUploadKey","$uploadKeyDisplay","$copyUploadKey","$regenUploadKey","key","hiddenRegex","removeAttr","hidden","test","val","replace","children","toggleClass","$btn","upload_key","close","fadeTo","trigger","select","copy","$uploadList","$noimgAlert","wipeUpload","$link","requireConfirm","$image","closest","id","$content","mk","append","siblings","first","page","search","match","orderby","params","parseInt","parent","length","Math","max","push","slice","join","$newhtml","newhtml","newTotal","total","usedSpace","remove","html","filter","replaceWith","text","removeClass","selectionChange","$el","checked","$imageWrap","$allWraps","addBack","$unsel","addClass","prop","$selection","Laravel","jsLocales","multiwipe_dialog_title","translatePlaceholders","multiwipe_dialog_text","cnt","each","find","ctrlKey","altKey","$input","newchecked","$this","document","shiftKey","jQuery"],"mappings":"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","file":"../js/uploads.js","sourcesContent":["(function ($) {\n    'use strict';\n\n    let $uploadToggle = $('#uploads-toggle');\n    $uploadToggle.on('click', function (e) {\n        e.preventDefault();\n\n        let action = $uploadToggle.hasClass('btn-success') ? 'enable' : 'disable',\n            title = $uploadToggle.attr('data-dialogtitle'),\n            content = $uploadToggle.attr('data-dialogcontent');\n\n        $.Dialog.confirm(title, content, function (sure) {\n            if (!sure) return;\n\n            $.Dialog.wait(false);\n\n            $.post(`/uploads/setting/${action}`, $.mkAjaxHandler(function () {\n                if (!this.status) return $.Dialog.fail(false, this.message);\n\n                $.Dialog.success(false, this.message);\n                setTimeout(function () {\n                    window.location.reload()\n                }, 1500);\n            }));\n        });\n    });\n\n    let $revealUploadKey = $('#reveal-upload-key'),\n        $uploadKeyDisplay = $('#upload-key-display'),\n        $copyUploadKey = $('#copy-upload-key'),\n        $regenUploadKey = $('#regen-upload-key'),\n        key = $uploadKeyDisplay.attr('data-key'),\n        hiddenRegex = /^\\*+$/;\n    $uploadKeyDisplay.removeAttr('data-key');\n    $revealUploadKey.on('click', function (e) {\n        e.preventDefault();\n\n        let hidden = hiddenRegex.test($uploadKeyDisplay.val());\n\n        $uploadKeyDisplay.val(hidden ? key : key.replace(/./g, '*'));\n        $revealUploadKey.children('.fa').toggleClass('fa-eye fa-eye-slash');\n    });\n    $regenUploadKey.on('click', function (e) {\n        e.preventDefault();\n\n        let $btn = $(this);\n        $.Dialog.confirm($btn.attr('title'), $btn.attr('data-dialogcontent'), function (sure) {\n            if (!sure) return;\n\n            $.Dialog.wait(false);\n\n            $.post('/uploads/regen', $.mkAjaxHandler(function () {\n                if (!this.status) return $.Dialog.fail(false, this.message);\n\n                key = this.upload_key;\n                $.Dialog.close(function () {\n                    $uploadKeyDisplay.fadeTo(200, 0, function () {\n                        let hidden = hiddenRegex.test($uploadKeyDisplay.val());\n                        $uploadKeyDisplay.val(hidden ? key.replace(/./g, '*') : key);\n                        if (hidden)\n                            $revealUploadKey.trigger('click');\n                        $uploadKeyDisplay.fadeTo(200, 1);\n                    });\n                });\n            }));\n        });\n    });\n\n    $uploadKeyDisplay.on('click', function (e) {\n        e.preventDefault();\n\n        $uploadKeyDisplay[0].select();\n    });\n\n    $copyUploadKey.on('click', function (e) {\n        e.preventDefault();\n\n        $.copy(key, e);\n    });\n\n    let $uploadList = $('#upload-list'),\n        $noimgAlert = $('#noimg-alert'),\n        $uploadedTotal = $('#uploaded-total');\n    $uploadList.on('click', '.copy-upload-link', function (e) {\n        e.preventDefault();\n\n        $.copy($(this).siblings().first().prop('href'), e);\n    });\n    $uploadList.on('click', '.wipe-upload', function (e) {\n        e.preventDefault();\n\n        const $selection = $uploadList.children('.selected');\n        if ($selection.length) {\n            $.Dialog.confirm(\n                Laravel.jsLocales.multiwipe_dialog_title,\n                $.translatePlaceholders(Laravel.jsLocales.multiwipe_dialog_text, {cnt: $selection.length}),\n                function (sure) {\n                    if (!sure) return;\n\n                    $.Dialog.wait(false);\n\n                    $selection.each(function () {\n                        wipeUpload($(this).find('.wipe-upload'), false);\n                    });\n                }\n            );\n            return;\n        }\n\n        wipeUpload($(this), true);\n    }).on('click', '.image', function (e) {\n        if (e.ctrlKey && !e.altKey) {\n            e.preventDefault();\n\n            const\n                $input = $(this).find('.selection input'),\n                newchecked = !$input.prop('checked');\n            $input.prop('checked', newchecked);\n            selectionChange($input, newchecked);\n        }\n    }).on('click', '.image .selection input', function (e) {\n        const $this = $(this);\n        if (e.altKey && !e.ctrlKey)\n            $uploadList.find('.not-selected, .selected').removeClass('not-selected selected').find('.selection input').prop('checked', false);\n        else selectionChange($this, $this.prop('checked'));\n    });\n\n    function wipeUpload($link, requireConfirm) {\n        let $image = $link.closest('.image'),\n            id = $image.attr('id').replace(/^upload-/, ''),\n            $content = $.mk('div').attr('id', 'img-wipe-confirm').append(\n                $.mk('p').append($link.attr('data-dialogcontent')),\n                $.mk('div').attr('class', 'del-img-wrap').append(\n                    $.mk('img').attr('src', $link.siblings().first().attr('href'))\n                )\n            );\n        const confirm = function (sure) {\n            if (!sure) return;\n\n            if (requireConfirm)\n                $.Dialog.wait(false);\n\n            let page = window.location.search.match(/page=(\\d+)/),\n                orderby = window.location.search.match(/orderby=([a-z]+)[ +](asc|desc)/i),\n                params = [];\n            if (page) {\n                page = parseInt(page[1], 10);\n                if ($image.parent().siblings().length === 0)\n                    page = Math.max(page - 1, 1);\n                params.push('page=' + page);\n            }\n            if (orderby)\n                params.push('orderby=' + (orderby.slice(1).join('+')));\n            $.post('/uploads/wipe' + (params.length ? '?' + (params.join('&')) : ''), {id: id}, $.mkAjaxHandler(function () {\n                if (!this.status) return $.Dialog.fail(false, this.message);\n\n                let $newhtml = $(this.newhtml),\n                    newTotal = this.total,\n                    usedSpace = this.usedSpace;\n\n                $.Dialog.close(function () {\n                    $image.closest('.image-wrap').fadeTo(500, 0, function () {\n                        $(this).remove();\n                        $uploadList.html($newhtml.filter('#upload-list').children());\n                        $('.pagination-wrapper').replaceWith($newhtml.filter('.pagination-wrapper'));\n                        $noimgAlert = $('#noimg-alert');\n                        $uploadedTotal = $('#uploaded-total');\n                        $uploadedTotal.text(newTotal);\n                        $('#used-space').text(usedSpace);\n                        if ($uploadList.children().length === 0) {\n                            $noimgAlert.removeClass('hidden');\n                            $uploadList.remove();\n                        }\n                    });\n                });\n            }));\n        };\n        if (requireConfirm)\n            $.Dialog.confirm($link.attr('data-dialogtitle'), $content, confirm);\n        else confirm(true);\n    }\n\n    function selectionChange($el, checked) {\n        const $imageWrap = $el.closest('.image').parent();\n\n        $imageWrap[checked ? 'addClass' : 'removeClass']('selected');\n        const $allWraps = $imageWrap.siblings().addBack();\n        $allWraps.removeClass('not-selected');\n        const $unsel = $allWraps.filter(':not(.selected)');\n        if ($unsel.length < $allWraps.length)\n            $unsel.addClass('not-selected');\n    }\n\n    $(document).on('keydown', e => {\n        if (!/^a$/i.test(e.key) || !e.ctrlKey || e.shiftKey || e.altKey) {\n            return;\n        }\n\n        e.preventDefault();\n        $('.image-wrap').addClass('selected').removeClass('not-selected').find('.selection input').prop('checked', true);\n    });\n})(jQuery);\n"]}